# needsrootforbuild

Url:            http://www.suse.com/cloud
Name:           __NAME__
Summary:        SUSE Cloud product .iso
Version:        __VERSION__
Release:        __RELEASE__
Group:          System/Management
License:        GPLv2
Source:         __SOURCE__
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
BuildArch:      noarch

%define _isodir /srv/isos

%description
This package installs the SUSE Cloud product .iso into %_isodir.  It
is intended to be installed on the SUSE Cloud admin server.

%prep
%setup -c -n %name

%build
# empty: no compile job

%install

install -d -m 755 $RPM_BUILD_ROOT%_isodir
ln %{S:0} $RPM_BUILD_ROOT%_isodir

%clean
rm -rf $RPM_BUILD_ROOT

%post
me="%{name}-%{version}-%{release}.%{arch}.rpm"
iso=$( echo %_isodir/%{name}-%{version}-%{release}.iso )

cat <<EOF

# Auto-generated by $me at `date`
$iso   /srv/tftpboot/repos/Cloud   iso9660 noauto 0 0
# End auto-generated section from $me"
EOF

%postun
me="%{name}-%{version}-%{release}.%{arch}.rpm"
iso=$( echo %_isodir/%{name}-%{version}-%{release}.iso )

perl -0777pi -e \
    "s/\n+# Auto-generated by $me.*\n(.*\n)*^# End auto-generated section from $me//m" \
    /etc/fstab

%files
%defattr(-, root, root)
%_isodir
